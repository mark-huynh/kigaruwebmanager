<!DOCTYPE html>
<html lang="en">

<head>
    <title>Kigaru Web Manager</title>
</head>

<body>
    <h1>Kigaru Web Manager</h1>
    <button id="grab">Grab Kigaru Files</button>
    <!-- Disable button if certain files exit -->
    <button id="update">Update Kigaru Files</button>
    <!-- Will call a git pull, and after first click say it is updated -->
    <div>
        Modify menu:
        <select id="type">
                <option value="sushi">Sushi Items</option>
                <option value="maindish">Main Dishes</option>
                <option value="appetizer">Appetizers</option>
                <option value="drinks">Drinks/Dessert</option>
            </select>
            <select id='section'>
                <option>makirolls</option>
            </select>
            <!-- TODO: Parse actual files for each of the sections in type -->
        
            <button id="add">Add</button>
            <button id='remove'>Remove</button>
            <button id="price">Change price</button>
            <button id="desc">Change description</button>
            <button id="img">Add image</button>
        
    </div>
    <div>
        Added Items:
        <ul></ul>
    </div>
    <button id="submit">Submit all changes</button>

    <script>

        const electron = require('electron');
        const { ipcRenderer } = electron;
        const util = require('util');
        const exec = util.promisify(require('child_process').exec);


        //Add button
        const add = document.querySelector('#add');
        add.addEventListener('click', openAddWindow);

        function openAddWindow(){
            const selectedType = document.getElementById("type").value;
            const selectedSection = document.getElementById("section").value;
            const selected = new Array(selectedType, selectedSection);
            ipcRenderer.send('add:open', selected);
        }

        //Remove button
        const remove = document.querySelector('#remove');
        remove.addEventListener('click', openRemoveWindow);

        function openRemoveWindow(){
            const selectedType = document.getElementById("type").value;
            ipcRenderer.send('remove:open', selectedType);
        }

        //Price button
        const price = document.querySelector('#price');
        price.addEventListener('click', openPriceWindow);

        function openPriceWindow(){
            const selectedType = document.getElementById("type").value;
            ipcRenderer.send('price:open', selectedType);
        }

        //Description button
        const description = document.querySelector('#desc');
        description.addEventListener('click', openDescriptionWindow);

        function openDescriptionWindow(){
            const selectedType = document.getElementById("type").value;
            ipcRenderer.send('description:open', selectedType);
        }




        //Grab Kigaru Files button
        const grab = document.querySelector('#grab');
        grab.addEventListener('click', gitCall);

        function gitCall() {
            exec('git clone https://github.com/mark-huynh/kigaruweb.git && cd kigaruweb && npm install')
        }


        //Adding info to UL
        const ul = document.querySelector('ul');
        ipcRenderer.on('item:add', function (e, item) {
            const li = document.createElement('li');
            const itemText = document.createTextNode("Added Item: " + item[2] + item[3] + item[4]);
            li.appendChild(itemText);
            ul.appendChild(li);
        })
        ipcRenderer.on('item:remove', function (e, item) {
            const li = document.createElement('li');
            const itemText = document.createTextNode("Removed Item: " + item[1] + " from " + item[0]);
            li.appendChild(itemText);
            ul.appendChild(li);
        })
        ipcRenderer.on('item:price', function (e, item) {
            const li = document.createElement('li');
            const itemText = document.createTextNode("Changed Item Price: " + item[1] + " to " + item[2] + " from " + item[0]);
            li.appendChild(itemText);
            ul.appendChild(li);
        })
        ipcRenderer.on('item:description', function (e, item) {
            const li = document.createElement('li');
            const itemText = document.createTextNode("Changed Item Description: " + item[1] + " to " + item[2] + " from " + item[0]);
            li.appendChild(itemText);
            ul.appendChild(li);
        })
    </script>
</body>

</html>