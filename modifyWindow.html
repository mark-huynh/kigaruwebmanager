<!DOCTYPE html>
<html lang="en">

<head>
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
</head>

<body class='modify-wrapper'>
    <h1></h1>
    <form>
        <div id="input-area">
            <label>Enter Item Name (Please enter full name exactly as it shows on the website)</label>
            <input type="text" id="name" autofocus>
        </div>
        <button id= 'submit' type='submit'>Submit</button>
    </form>
</body>

<script>
    const electron = require('electron');
    const { ipcRenderer } = electron;

    const { dialog } = require('electron').remote;
    
    let remove = false;
    let price = false;
    let desc = false;
    let image = false;

    //Initalizing page
    let filePath = "";
    const h1 = document.querySelector("h1");
    ipcRenderer.on('remove:open', function (e, item) {
        filePath = item;
        remove = true;
        h1.innerHTML = "Removing from: " + filePath;
    })
    ipcRenderer.on('price:open', function (e, item) {
        filePath = item;
        price = true;
        h1.innerHTML = "Changing price of item in: " + filePath;
        var label = document.createElement("label");
        var textnode = document.createTextNode("Input the new price of this item")
        label.appendChild(textnode);
        document.getElementById("input-area").appendChild(label);
        var input = document.createElement("input");
        input.id = "price";
        input.type = "number"
        document.getElementById("input-area").appendChild(input);
    })
    ipcRenderer.on('description:open', function (e, item) {
        filePath = item;
        desc = true;
        h1.innerHTML = "Changing Description of item in: " + filePath;
        var label = document.createElement("label");
        var textnode = document.createTextNode("Input the new description of this item")
        label.appendChild(textnode);
        document.getElementById("input-area").appendChild(label);
        var input = document.createElement("input");
        input.id = "description";
        document.getElementById("input-area").appendChild(input);
    })
    ipcRenderer.on('picture:open', function (e, item) {
        filePath = item;
        image = true;
        h1.innerHTML = "Changing Picture of item in: " + filePath;
        var label = document.createElement("label");
        var textnode = document.createTextNode("Choose the image that you would like to add to this item")
        label.appendChild(textnode);
        document.getElementById("input-area").appendChild(label);
        var fileExplorer = document.createElement("button");
        fileExplorer.appendChild(document.createTextNode("Choose .jpg image"))
        document.getElementById("input-area").appendChild(fileExplorer);
        fileExplorer.addEventListener('click', getFilePath);
        var locationText = document.createElement("div");
        locationText.id = "path-text";
        document.getElementById("input-area").appendChild(locationText);
        document.getElementById("path-text").appendChild(document.createTextNode(""));

    })
    //TODO: open file explorer of only images of .jpg on click of the button and store the path. 
    //    console.log(dialog.showOpenDialog({ properties: ['openFile', 'openDirectory', 'multiSelections'] }))

    let imgPath = "";

    async function getFilePath(){
        let test = await dialog.showOpenDialog({ properties: ['openFile', 'openDirectory', 'multiSelections'] }, (filePaths) => {
            imgPath = filePaths;
            document.getElementById("path-text").removeChild(document.getElementById("path-text").childNodes[0]);
            document.getElementById("path-text").appendChild(document.createTextNode(filePaths));
        });
    }

    //Handling remove, TODO: generalize for remove, change price, desc, and pic
    const submit = document.querySelector('#submit');
    submit.addEventListener('click', (e) => submitForm(e));

    function submitForm(e) {
        e.preventDefault();
        const name = '\"' + document.querySelector('#name').value + '\"';
        if(remove)
        {
            const payload = new Array(filePath, name);
            ipcRenderer.send('item:remove', payload);
        }
        else if(price)
        {
            const price = '\"' + document.querySelector('#price').value + '\"';
            const payload = new Array(filePath, name, price);
            ipcRenderer.send('item:price', payload);
        }
        else if(desc)
        {
            const description = '\"' + document.querySelector('#description').value + '\"';
            const payload = new Array(filePath, name, description);
            ipcRenderer.send('item:description', payload);
        }
        else if(image)
        {
            //file path to constant file, import name for item, item name that is given picture
            const payload = new Array(imgPath, filePath, name);
            ipcRenderer.send('item:picture', payload);
        }
    }

</script>

</html>